<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOULINIRI OS</title>
    <style>
        :root { --bg: #0d0f14; --card: #161b22; --accent: #00a8ff; --text: #c9d1d9; }
        body { background: var(--bg); color: var(--text); font-family: 'Courier New', Courier, monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: var(--card); padding: 30px; border-radius: 12px; width: 90%; max-width: 340px; text-align: center; border: 1px solid #30363d; box-shadow: 0 10px 50px rgba(0,0,0,0.5); }
        .balance { font-size: 40px; color: #58a6ff; font-weight: bold; margin: 20px 0; text-shadow: 0 0 10px rgba(88,166,255,0.3); }
        input { background: #010409; border: 1px solid #30363d; color: #3fb950; padding: 12px; width: 100%; box-sizing: border-box; margin-bottom: 10px; border-radius: 6px; outline: none; }
        button { background: #238636; color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; margin-bottom: 5px; }
        button.sync { background: #1f6feb; margin-top: 10px; }
        .log { background: #010409; padding: 10px; font-size: 11px; color: #8b949e; text-align: left; height: 60px; overflow-y: auto; border-radius: 4px; margin-top: 15px; border: 1px solid #30363d; }
    </style>
</head>
<body>

    <div class="box">
        <div style="font-size: 12px; color: #8b949e;">LOCAL DATABASE ACTIVE</div>
        <div class="balance"><span id="yl-val">0</span> YL</div>
        
        <input type="text" id="token" placeholder="CODICE RISCATTO">
        <button onclick="redeem()">ESEGUI RISCATTO</button>
        
        <button class="sync" onclick="generateLink()">GENERA LINK PER AMICO</button>
        
        <div class="log" id="log">> Sistema pronto.</div>
    </div>

    <script>
        // Carica i dati dal telefono
        let balance = parseInt(localStorage.getItem('yl_balance')) || 0;
        document.getElementById('yl-val').innerText = balance;

        // I tuoi codici premio
        const KEYS = { "5329HL7614a646hN593": 5, "75nC639hH1L2M2NA": 5, "43510Npy462A598317d": 10 };

        // 1. CONTROLLO SE SEI ENTRATO CON UN LINK DI UN AMICO
        const params = new URLSearchParams(window.location.search);
        const sharedData = params.get('share');
        if (sharedData) {
            try {
                // Decodifica i dati dall'URL (Base64)
                const decoded = atob(sharedData); 
                const bonus = parseInt(decoded);
                if (!isNaN(bonus)) {
                    balance += bonus;
                    updateData(`Ricevuti ${bonus} YL da un link!`);
                    // Pulisce l'URL dopo il riscatto
                    window.history.replaceState({}, document.title, "/");
                }
            } catch(e) { console.error("Link non valido"); }
        }

        function redeem() {
            const code = document.getElementById('token').value.trim();
            if (KEYS[code]) {
                balance += KEYS[code];
                updateData(`Riscattati +${KEYS[code]} YL`);
                document.getElementById('token').value = "";
            } else {
                addLog("Codice non valido.");
            }
        }

        // 2. GENERA IL LINK DA 29+ CARATTERI
        function generateLink() {
            const amount = prompt("Quanti Youli vuoi inviare al tuo amico?", "5");
            const val = parseInt(amount);
            
            if (val > 0 && val <= balance) {
                balance -= val; // Li toglie a te per darli a lui
                // Trasforma il valore in una stringa codificata (Base64) per creare l'indirizzo casuale
                const encoded = btoa(val.toString());
                const randomSalt = [...Array(20)].map(() => Math.random().toString(36)[2]).join('');
                const shareLink = `${window.location.origin}/?share=${encoded}&id=${randomSalt}`;
                
                updateData(`Inviati ${val} YL.`);
                addLog("COPIA QUESTO LINK:");
                addLog(shareLink);
                console.log("Link generato:", shareLink);
                alert("Link Generato! Copialo dal log nero in basso.");
            } else {
                alert("Saldo insufficiente o valore non valido!");
            }
        }

        function updateData(msg) {
            localStorage.setItem('yl_balance', balance);
            document.getElementById('yl-val').innerText = balance;
            addLog(msg);
        }

        function addLog(m) {
            const l = document.getElementById('log');
            l.innerHTML += `<br>> ` + m;
            l.scrollTop = l.scrollHeight;
        }
    </script>
</body>
</html>