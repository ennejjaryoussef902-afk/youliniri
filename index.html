<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>YOULINIRI</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --blue: #007aff; --white: #ffffff; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); font-family: -apple-system, sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #auth-screen, #main-interface { background: var(--white); padding: 40px; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); text-align: center; width: 350px; }
        .input-group { background: #f2f2f7; border-radius: 12px; margin-bottom: 12px; padding: 0 15px; display: flex; align-items: center; }
        input { background: transparent; border: none; padding: 12px; width: 100%; outline: none; font-size: 15px; }
        .btn-main { background: var(--blue); color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; margin-top: 5px; transition: 0.2s; }
        .btn-main:active { transform: scale(0.95); }
        .points-box { margin-bottom: 20px; padding: 20px; background: #f8f9ff; border-radius: 20px; border: 2px solid #e0e7ff; }
        #balance { font-size: 48px; font-weight: bold; color: var(--blue); }
        .transfer-section { border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px; }
        h3 { font-size: 12px; color: #8e8e93; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }
        #msg { margin-top: 15px; font-weight: bold; font-size: 13px; min-height: 18px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <h2 style="letter-spacing: 2px;">YOULINIRI</h2>
        <div class="input-group"><input id="u" placeholder="Username"></div>
        <div class="input-group"><input id="p" type="password" placeholder="Password"></div>
        <button class="btn-main" onclick="entra()">SIGN UP</button>
    </div>

    <div id="main-interface" style="display:none;">
        <div class="points-box">
            <p style="color: #666; margin: 0; font-size: 14px;">I tuoi Youli</p>
            <div id="balance">0</div>
        </div>

        <div class="redeem-section">
            <h3>Riscatto Codice</h3>
            <div class="input-group"><input id="codice" placeholder="Inserisci codice YOULI..."></div>
            <button class="btn-main" onclick="eseguiRiscatto()">RISCATTO</button>
        </div>

        <div class="transfer-section">
            <h3>Invia Youli</h3>
            <div class="input-group"><input id="destinatario" placeholder="A chi? (Username)"></div>
            <div class="input-group"><input id="quantita" type="number" placeholder="Quanti Youli?"></div>
            <button class="btn-main" style="background: #34c759;" onclick="inviaYouli()">INVIA ORA</button>
        </div>
        
        <p id="msg"></p>
    </div>

    <script>
        // LE TUE CHIAVI (USABILI ALL'INFINITO)
        const KEYS = { 
            "5329HL7614a646hN593": 5, 
            "75nC639hH1L2M2NA": 5, 
            "43510Npy462A598317d": 10 
        };

        let mioUsername = "";
        let totaleYouli = 0;
        let peer;

        function entra() {
            mioUsername = document.getElementById('u').value.trim().toLowerCase();
            if(mioUsername && document.getElementById('p').value) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-interface').style.display = 'block';
                setupPeer();
            } else {
                alert("Inserisci i dati per il Sign Up!");
            }
        }

        function setupPeer() {
            peer = new Peer('yln_' + mioUsername);
            peer.on('connection', conn => {
                conn.on('data', data => {
                    if(data.tipo === 'invio_youli') {
                        totaleYouli += data.quantita;
                        aggiornaGrafica(`Hai ricevuto ${data.quantita} Youli da ${data.mittente}! üí∏`, "#28a745");
                    }
                });
            });
        }

        function eseguiRiscatto() {
            const code = document.getElementById('codice').value.trim();
            if(KEYS[code]) {
                const valore = KEYS[code];
                totaleYouli += valore;
                aggiornaGrafica(`+${valore} Youli aggiunti! üöÄ`, "#28a745");
                // NOTA: La riga per cancellare il codice √® stata rimossa, quindi √® infinito!
            } else {
                aggiornaGrafica("Codice non valido ‚ùå", "#dc3545");
            }
            document.getElementById('codice').value = "";
        }

        function inviaYouli() {
            const dest = document.getElementById('destinatario').value.trim().toLowerCase();
            const qta = parseInt(document.getElementById('quantita').value);

            if(!dest || isNaN(qta) || qta <= 0) return aggiornaGrafica("Dati mancanti o errati!", "#dc3545");
            if(qta > totaleYouli) return aggiornaGrafica("Saldo insufficiente!", "#dc3545");

            const conn = peer.connect('yln_' + dest);
            conn.on('open', () => {
                conn.send({
                    tipo: 'invio_youli',
                    quantita: qta,
                    mittente: mioUsername
                });
                totaleYouli -= qta;
                aggiornaGrafica(`Inviati ${qta} Youli a ${dest} ‚úÖ`, "#007aff");
                document.getElementById('destinatario').value = "";
                document.getElementById('quantita').value = "";
            });

            conn.on('error', err => {
                aggiornaGrafica("L'utente non √® online!", "#dc3545");
            });
        }

        function aggiornaGrafica(testo, colore) {
            document.getElementById('balance').innerText = totaleYouli;
            const msg = document.getElementById('msg');
            msg.innerText = testo;
            msg.style.color = colore;
        }
    </script>
</body>
</html>
